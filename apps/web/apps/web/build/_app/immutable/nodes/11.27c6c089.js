import{a as e,f as u,t as m,c as ne}from"../chunks/1f615a2c.js";import{p as tt,m as N,v as rt,d as at,l as s,i as t,t as H,a as st,c as p,n as d,r as f,s as a,f as y,o as le}from"../chunks/8b0cb860.js";import{s as I}from"../chunks/63f41f2c.js";import{i as U}from"../chunks/c17651b9.js";import{c as h}from"../chunks/c1381360.js";import{r as ot,s as it,a as nt}from"../chunks/0701c483.js";import{a as G}from"../chunks/fb331d7f.js";import{B as Y}from"../chunks/8f85ef07.js";import{C as Ce}from"../chunks/840838e0.js";import{C as Te}from"../chunks/3cc6752e.js";import{C as Ne,a as Le,b as qe}from"../chunks/4e6716dc.js";import{C as lt}from"../chunks/48858408.js";import{L as Fe,I as Me}from"../chunks/48c7201b.js";import{u as dt,a as Qe}from"../chunks/b1448760.js";const ct="BAMUxEusHpgEXQMQFOYWAly4QkhiClgY9P6YpYa9vQo4ZdpUvLFD0MRvuD-4MO8sIpbEoF4gWMjOhc-BjKdHF2g";function ut(te){const V="=".repeat((4-te.length%4)%4),A=(te+V).replace(/-/g,"+").replace(/_/g,"/"),b=window.atob(A),P=new Uint8Array(b.length);for(let z=0;z<b.length;++z)P[z]=b.charCodeAt(z);return P}async function vt(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("Push notifications not supported"),null;if(await Notification.requestPermission()!=="granted")return console.warn("Notification permission denied"),null;const V=await navigator.serviceWorker.register("/sw.js");await navigator.serviceWorker.ready;const A=await V.pushManager.getSubscription();A&&await A.unsubscribe();const b=ut(ct);return await V.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:b.buffer})}var pt=u("<!> <!>",1),ft=u("<span> </span>"),_t=u('<p class="text-green-600">Notifications are enabled!</p> <div class="flex items-center gap-4 flex-wrap"><!> <!> <!></div>',1),mt=u("<!> <!>",1),gt=u("<!> <!>",1),$t=u('<p class="text-muted-foreground">Loading preferences...</p>'),ht=u('<p class="text-destructive">Error loading preferences</p>'),bt=u('<div class="grid grid-cols-2 gap-4"><div class="space-y-2"><!> <!> <p class="meta-text">Hour (0-23) when quiet hours begin</p></div> <div class="space-y-2"><!> <!> <p class="meta-text">Hour (0-23) when quiet hours end</p></div></div> <div class="space-y-2"><!> <!> <p class="meta-text">Number of reminder notifications per phrase per day</p></div>',1),xt=u('<span class="text-green-600">Saved!</span>'),yt=u("<!> <!>",1),Pt=u("<!> <!> <!>",1),wt=u("<!> <!>",1),kt=u('<p class="text-muted-foreground">Loading subscription...</p>'),St=u('<p class="text-destructive">Error loading subscription</p>'),Et=u('<p class="text-destructive"> </p>'),Ct=u('<p class="meta-text mt-2 text-orange-600">Backend toggle is currently disabled. Enable `BILLING_DEV_TOGGLE=true` in Convex env.</p>'),Tt=u('<p class="meta-text mt-2 text-green-600"> </p>'),Nt=u('<p class="meta-text mt-2 text-destructive"> </p>'),Lt=u('<div class="flex flex-col gap-2"><p>Current tier: <span class="font-semibold capitalize"> </span></p> <p class="meta-text"> </p> <p class="meta-text"> </p></div> <div class="flex flex-wrap gap-3"><!> <!></div> <!> <div class="mt-4 border border-border/60 bg-muted/40 p-4"><p class="info-kicker">Dev Tier Switch</p> <p class="meta-text mt-2">Instantly switch your current user between `free`, `ai`, and `pro` without checkout.</p> <!> <div class="mt-3 flex flex-wrap gap-2"><!> <!> <!></div> <!> <!></div>',1),qt=u("<!> <!>",1),Ft=u('<div class="page-shell page-shell--narrow page-stack"><div class="page-stack"><a class="meta-text underline">&larr; Back to phrase library</a> <p class="info-kicker">Keep Sessions Sustainable</p> <h1 class="text-5xl sm:text-6xl">Settings</h1></div> <!> <!> <!></div>');function Zt(te,V){tt(V,!0);const A=dt(),b=Qe(G.preferences.get,{}),P=Qe(G.billing.getStatus,{});let z=N(22),de=N(8),ce=N(3),xe=N(rt(Intl.DateTimeFormat().resolvedOptions().timeZone)),ue=N(!1),ve=N(!1),J=N(!1),pe=N(!1),j=N(null),X=N(!1),fe=N(null),re=N(!1),_e=N(null),me=N(null),ze=le(()=>!!b.data?.pushSubscription);at(()=>{b.data&&(s(z,b.data.quietHoursStart,!0),s(de,b.data.quietHoursEnd,!0),s(ce,b.data.notificationsPerPhrase,!0),s(xe,b.data.timeZone??t(xe),!0))});async function Ke(){s(ue,!0),s(ve,!1);try{await We(),s(ve,!0),setTimeout(()=>s(ve,!1),2e3)}catch(n){console.error("Failed to save preferences:",n)}finally{s(ue,!1)}}async function We(){await A.mutation(G.preferences.upsert,{quietHoursStart:t(z),quietHoursEnd:t(de),notificationsPerPhrase:t(ce),timeZone:t(xe)})}async function Ie(){s(J,!0);try{const n=await vt();n&&await A.mutation(G.preferences.upsert,{pushSubscription:JSON.stringify(n.toJSON())})}catch(n){console.error("Failed to enable notifications:",n)}finally{s(J,!1)}}async function Ye(){s(pe,!0),s(j,null);try{await A.action(G.notificationsNode.sendTest,{}),s(j,{success:!0,message:"Test notification sent!"},!0)}catch(n){s(j,{success:!1,message:n instanceof Error?n.message:"Failed to send test notification"},!0)}finally{s(pe,!1),setTimeout(()=>s(j,null),5e3)}}async function De(n){s(X,!0),s(fe,null);try{const w=await A.mutation(G.billing.createPayfastCheckout,{plan:n}),D=document.createElement("form");D.method="POST",D.action=w.endpointUrl;const ge=w.fields;Object.entries(ge).forEach(([B,R])=>{const O=document.createElement("input");O.type="hidden",O.name=B,O.value=R,D.appendChild(O)}),document.body.appendChild(D),D.submit(),D.remove()}catch(w){s(fe,w instanceof Error?w.message:"Failed to start checkout",!0)}finally{s(X,!1)}}async function ye(n){s(re,!0),s(_e,null),s(me,null);try{await A.mutation(G.billing.setMyTierForDev,{tier:n,resetDailyUsage:!0}),s(me,`Switched to ${n} tier (dev mode).`)}catch(w){s(_e,w instanceof Error?w.message:"Failed to switch dev tier",!0)}finally{s(re,!1)}}var Pe=Ft(),we=p(Pe),Ze=p(we);d(4),f(we);var He=a(we,2);h(He,()=>Ce,(n,w)=>{w(n,{class:"border border-border/60 bg-background/85 backdrop-blur-sm",children:(D,ge)=>{var B=mt(),R=y(B);h(R,()=>Ne,(K,L)=>{L(K,{children:(q,W)=>{var k=pt(),_=y(k);h(_,()=>Le,(g,o)=>{o(g,{children:(r,l)=>{d();var v=m("Push Notifications");e(r,v)},$$slots:{default:!0}})});var x=a(_,2);h(x,()=>qe,(g,o)=>{o(g,{children:(r,l)=>{d();var v=m("Enable push notifications to receive vocabulary reminders.");e(r,v)},$$slots:{default:!0}})}),e(q,k)},$$slots:{default:!0}})});var O=a(R,2);h(O,()=>Te,(K,L)=>{L(K,{class:"space-y-4",children:(q,W)=>{var k=ne(),_=y(k);{var x=o=>{var r=_t(),l=a(y(r),2),v=p(l);Y(v,{onclick:Ye,get disabled(){return t(pe)},variant:"outline",children:($,S)=>{d();var E=m();H(()=>I(E,t(pe)?"Sending...":"Test Notification")),e($,E)},$$slots:{default:!0}});var F=a(v,2);Y(F,{onclick:Ie,get disabled(){return t(J)},variant:"ghost",size:"sm",children:($,S)=>{d();var E=m();H(()=>I(E,t(J)?"Refreshing...":"Refresh Subscription")),e($,E)},$$slots:{default:!0}});var Q=a(F,2);{var M=$=>{var S=ft(),E=p(S,!0);f(S),H(()=>{nt(S,1,t(j).success?"text-green-600":"text-destructive"),I(E,t(j).message)}),e($,S)};U(Q,$=>{t(j)&&$(M)})}f(l),e(o,r)},g=o=>{Y(o,{onclick:Ie,get disabled(){return t(J)},children:(r,l)=>{d();var v=m();H(()=>I(v,t(J)?"Enabling...":"Enable Notifications")),e(r,v)},$$slots:{default:!0}})};U(_,o=>{t(ze)?o(x):o(g,!1)})}e(q,k)},$$slots:{default:!0}})}),e(D,B)},$$slots:{default:!0}})});var Oe=a(He,2);h(Oe,()=>Ce,(n,w)=>{w(n,{class:"border border-border/60 bg-background/85 backdrop-blur-sm",children:(D,ge)=>{var B=Pt(),R=y(B);h(R,()=>Ne,(L,q)=>{q(L,{children:(W,k)=>{var _=gt(),x=y(_);h(x,()=>Le,(o,r)=>{r(o,{children:(l,v)=>{d();var F=m("Notification Preferences");e(l,F)},$$slots:{default:!0}})});var g=a(x,2);h(g,()=>qe,(o,r)=>{r(o,{children:(l,v)=>{d();var F=m("Configure when and how you receive reminders.");e(l,F)},$$slots:{default:!0}})}),e(W,_)},$$slots:{default:!0}})});var O=a(R,2);h(O,()=>Te,(L,q)=>{q(L,{class:"space-y-4",children:(W,k)=>{var _=ne(),x=y(_);{var g=r=>{var l=$t();e(r,l)},o=r=>{var l=ne(),v=y(l);{var F=M=>{var $=ht();e(M,$)},Q=M=>{var $=bt(),S=y($),E=p(S),$e=p(E);Fe($e,{for:"quietStart",children:(C,be)=>{d();var Z=m("Quiet Hours Start");e(C,Z)},$$slots:{default:!0}});var ae=a($e,2);Me(ae,{id:"quietStart",type:"number",min:"0",max:"23",placeholder:"22",get value(){return t(z)},set value(C){s(z,C,!0)}}),d(2),f(E);var he=a(E,2),se=p(he);Fe(se,{for:"quietEnd",children:(C,be)=>{d();var Z=m("Quiet Hours End");e(C,Z)},$$slots:{default:!0}});var ke=a(se,2);Me(ke,{id:"quietEnd",type:"number",min:"0",max:"23",placeholder:"8",get value(){return t(de)},set value(C){s(de,C,!0)}}),d(2),f(he),f(S);var ee=a(S,2),oe=p(ee);Fe(oe,{for:"perPhrase",children:(C,be)=>{d();var Z=m("Notifications Per Phrase");e(C,Z)},$$slots:{default:!0}});var Se=a(oe,2);Me(Se,{id:"perPhrase",type:"number",min:"1",max:"10",placeholder:"3",get value(){return t(ce)},set value(C){s(ce,C,!0)}}),d(2),f(ee),e(M,$)};U(v,M=>{b.error?M(F):M(Q,!1)},!0)}e(r,l)};U(x,r=>{b.isLoading?r(g):r(o,!1)})}e(W,_)},$$slots:{default:!0}})});var K=a(O,2);h(K,()=>lt,(L,q)=>{q(L,{class:"flex items-center gap-4",children:(W,k)=>{var _=yt(),x=y(_);{let r=le(()=>b.isLoading||t(ue));Y(x,{onclick:Ke,get disabled(){return t(r)},children:(l,v)=>{d();var F=m();H(()=>I(F,t(ue)?"Saving...":"Save Settings")),e(l,F)},$$slots:{default:!0}})}var g=a(x,2);{var o=r=>{var l=xt();e(r,l)};U(g,r=>{t(ve)&&r(o)})}e(W,_)},$$slots:{default:!0}})}),e(D,B)},$$slots:{default:!0}})});var je=a(Oe,2);h(je,()=>Ce,(n,w)=>{w(n,{class:"border border-border/60 bg-background/85 backdrop-blur-sm",children:(D,ge)=>{var B=qt(),R=y(B);h(R,()=>Ne,(K,L)=>{L(K,{children:(q,W)=>{var k=wt(),_=y(k);h(_,()=>Le,(g,o)=>{o(g,{children:(r,l)=>{d();var v=m("Subscription");e(r,v)},$$slots:{default:!0}})});var x=a(_,2);h(x,()=>qe,(g,o)=>{o(g,{children:(r,l)=>{d();var v=m("Manage your plan and daily recording minutes.");e(r,v)},$$slots:{default:!0}})}),e(q,k)},$$slots:{default:!0}})});var O=a(R,2);h(O,()=>Te,(K,L)=>{L(K,{class:"space-y-4",children:(q,W)=>{var k=ne(),_=y(k);{var x=o=>{var r=kt();e(o,r)},g=o=>{var r=ne(),l=y(r);{var v=Q=>{var M=St();e(Q,M)},F=Q=>{var M=Lt(),$=y(M),S=p($),E=a(p(S)),$e=p(E,!0);f(E),f(S);var ae=a(S,2),he=p(ae);f(ae);var se=a(ae,2),ke=p(se);f(se),f($);var ee=a($,2),oe=p(ee);Y(oe,{onclick:()=>De("ai"),get disabled(){return t(X)},children:(i,c)=>{d();var T=m();H(()=>I(T,t(X)?"Redirecting...":"Upgrade to AI (R150/mo)")),e(i,T)},$$slots:{default:!0}});var Se=a(oe,2);Y(Se,{onclick:()=>De("pro"),get disabled(){return t(X)},variant:"outline",children:(i,c)=>{d();var T=m();H(()=>I(T,t(X)?"Redirecting...":"Upgrade to Pro (R500/mo)")),e(i,T)},$$slots:{default:!0}}),f(ee);var C=a(ee,2);{var be=i=>{var c=Et(),T=p(c,!0);f(c),H(()=>I(T,t(fe))),e(i,c)};U(C,i=>{t(fe)&&i(be)})}var Z=a(C,2),Ue=a(p(Z),4);{var Ge=i=>{var c=Ct();e(i,c)};U(Ue,i=>{P.data?.devToggleEnabled===!1&&i(Ge)})}var Ee=a(Ue,2),Ae=p(Ee);{let i=le(()=>P.data?.tier==="free"?"default":"outline");Y(Ae,{size:"sm",get variant(){return t(i)},get disabled(){return t(re)},onclick:()=>ye("free"),children:(c,T)=>{d();var ie=m("Free");e(c,ie)},$$slots:{default:!0}})}var Be=a(Ae,2);{let i=le(()=>P.data?.tier==="ai"?"default":"outline");Y(Be,{size:"sm",get variant(){return t(i)},get disabled(){return t(re)},onclick:()=>ye("ai"),children:(c,T)=>{d();var ie=m("AI");e(c,ie)},$$slots:{default:!0}})}var Ve=a(Be,2);{let i=le(()=>P.data?.tier==="pro"?"default":"outline");Y(Ve,{size:"sm",get variant(){return t(i)},get disabled(){return t(re)},onclick:()=>ye("pro"),children:(c,T)=>{d();var ie=m("Pro");e(c,ie)},$$slots:{default:!0}})}f(Ee);var Re=a(Ee,2);{var Je=i=>{var c=Tt(),T=p(c,!0);f(c),H(()=>I(T,t(me))),e(i,c)};U(Re,i=>{t(me)&&i(Je)})}var Xe=a(Re,2);{var et=i=>{var c=Nt(),T=p(c,!0);f(c),H(()=>I(T,t(_e))),e(i,c)};U(Xe,i=>{t(_e)&&i(et)})}f(Z),H(i=>{I($e,P.data?.tier??"free"),I(he,`Status: ${P.data?.status??"unknown"??""}`),I(ke,`Minutes used today: ${i??""} / 
						${P.data?.minutesLimit??0??""}`)},[()=>P.data?.minutesUsed?.toFixed(1)??"0.0"]),e(Q,M)};U(l,Q=>{P.error?Q(v):Q(F,!1)},!0)}e(o,r)};U(_,o=>{P.isLoading?o(x):o(g,!1)})}e(q,k)},$$slots:{default:!0}})}),e(D,B)},$$slots:{default:!0}})}),f(Pe),H(n=>it(Ze,"href",n),[()=>ot("/")]),e(te,Pe),st()}export{Zt as component};

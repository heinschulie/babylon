import{a as L,f as P,t as te}from"../chunks/1f615a2c.js";import{T as ae,y as ne,aW as re,w as N,E as se,_ as F,C as W,B as U,D as oe,$ as ie,d as H,l as h,i as o,aX as I,m as b,v as ce,o as T,aY as V,p as X,t as M,a as q,c as y,r as A,s as B,n as le,f as ue}from"../chunks/8b0cb860.js";import{r as C,s as _,d as fe}from"../chunks/0701c483.js";import{s as z,C as de}from"../chunks/b1448760.js";import{a as Y}from"../chunks/1d947441.js";import"../chunks/a9f1842f.js";import{i as he,a as ve,s as pe}from"../chunks/c17651b9.js";import{i as ge}from"../chunks/ddb675d8.js";import{g as me}from"../chunks/dd297ec3.js";import{p as j}from"../chunks/4b7ed212.js";import{B as _e}from"../chunks/8f85ef07.js";import{a as we}from"../chunks/8c84ee26.js";import{o as ke}from"../chunks/a5659130.js";function xe(e,n){let t=null,a=N;var s;if(N){t=oe;for(var r=ie(document.head);r!==null&&(r.nodeType!==se||r.data!==e);)r=F(r);if(r===null)W(!1);else{var l=F(r);r.remove(),U(l)}}N||(s=document.head.appendChild(ae()));try{ne(()=>n(s),re)}finally{a&&(W(!0),U(t))}}const ye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='107'%20height='128'%20viewBox='0%200%20107%20128'%3e%3ctitle%3esvelte-logo%3c/title%3e%3cpath%20d='M94.157%2022.819c-10.4-14.885-30.94-19.297-45.792-9.835L22.282%2029.608A29.92%2029.92%200%200%200%208.764%2049.65a31.5%2031.5%200%200%200%203.108%2020.231%2030%2030%200%200%200-4.477%2011.183%2031.9%2031.9%200%200%200%205.448%2024.116c10.402%2014.887%2030.942%2019.297%2045.791%209.835l26.083-16.624A29.92%2029.92%200%200%200%2098.235%2078.35a31.53%2031.53%200%200%200-3.105-20.232%2030%2030%200%200%200%204.474-11.182%2031.88%2031.88%200%200%200-5.447-24.116'%20style='fill:%23ff3e00'/%3e%3cpath%20d='M45.817%20106.582a20.72%2020.72%200%200%201-22.237-8.243%2019.17%2019.17%200%200%201-3.277-14.503%2018%2018%200%200%201%20.624-2.435l.49-1.498%201.337.981a33.6%2033.6%200%200%200%2010.203%205.098l.97.294-.09.968a5.85%205.85%200%200%200%201.052%203.878%206.24%206.24%200%200%200%206.695%202.485%205.8%205.8%200%200%200%201.603-.704L69.27%2076.28a5.43%205.43%200%200%200%202.45-3.631%205.8%205.8%200%200%200-.987-4.371%206.24%206.24%200%200%200-6.698-2.487%205.7%205.7%200%200%200-1.6.704l-9.953%206.345a19%2019%200%200%201-5.296%202.326%2020.72%2020.72%200%200%201-22.237-8.243%2019.17%2019.17%200%200%201-3.277-14.502%2017.99%2017.99%200%200%201%208.13-12.052l26.081-16.623a19%2019%200%200%201%205.3-2.329%2020.72%2020.72%200%200%201%2022.237%208.243%2019.17%2019.17%200%200%201%203.277%2014.503%2018%2018%200%200%201-.624%202.435l-.49%201.498-1.337-.98a33.6%2033.6%200%200%200-10.203-5.1l-.97-.294.09-.968a5.86%205.86%200%200%200-1.052-3.878%206.24%206.24%200%200%200-6.696-2.485%205.8%205.8%200%200%200-1.602.704L37.73%2051.72a5.42%205.42%200%200%200-2.449%203.63%205.79%205.79%200%200%200%20.986%204.372%206.24%206.24%200%200%200%206.698%202.486%205.8%205.8%200%200%200%201.602-.704l9.952-6.342a19%2019%200%200%201%205.295-2.328%2020.72%2020.72%200%200%201%2022.237%208.242%2019.17%2019.17%200%200%201%203.277%2014.503%2018%2018%200%200%201-8.13%2012.053l-26.081%2016.622a19%2019%200%200%201-5.3%202.328'%20style='fill:%23fff'/%3e%3c/svg%3e",Ae="https://disciplined-spider-126.convex.cloud",Ce=Object.prototype.toString,be=e=>Ce.call(e)==="[object Error]",Te=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function J(e){if(!(e&&be(e)&&e.name==="TypeError"&&typeof e.message=="string"))return!1;const{message:t,stack:a}=e;return t==="Load failed"?a===void 0||"__sentry_captured__"in e:t.startsWith("error sending request for url")?!0:Te.has(t)}const K=Symbol("auth-context");function $e({authClient:e,convexUrl:n,convexClient:t,options:a,externalSession:s,getServerState:r}){return s?Ee({authClient:e,convexUrl:n,convexClient:t,options:a,externalSession:s}):Se({authClient:e,convexUrl:n,convexClient:t,options:a,getServerState:r})}const G=(e,n,t)=>{const a=e;let s=n;return s||(s=Oe(a,{disabled:!1,...t})),{url:a,convexClient:s}};function Se({authClient:e,convexUrl:n,convexClient:t,options:a,getServerState:s}){const r=s?.(),l=r!==void 0,i=r?.isAuthenticated===!0;let u=b(null),f=b(!0),c=b(ce(i?!0:null)),p=b(!1),g=b(!1);e.useSession().subscribe(d=>{h(p,!0);const k=o(u)!==null;h(u,d.data,!0),h(f,d.isPending,!0),d.isPending||h(g,!0);const x=o(u)!==null;k&&!x&&h(c,!1),d.isPending&&o(c)!==null&&o(g)&&h(c,null)});const $=T(()=>o(u)!==null),v=T(()=>o(p)&&!o(f)),m=T(()=>o(v)?o($)&&(o(c)??!1):i),S=T(()=>o(v)?o(f)||o($)&&o(c)===null:!l),{convexClient:w}=G(n,t,a),E=Be(e,d=>{a?.verbose&&console.debug(`${new Date().toISOString()} ${d}`)});ke(()=>{De(e)}),H(()=>{let d=!0;return i||o($)?(w.setAuth(E,x=>{d&&h(c,x,!0)}),()=>{d=!1,h(c,o(c)?!1:null,!0)}):(w.client.clearAuth(),()=>{h(c,null)})}),I(K,{authClient:e,fetchAccessToken:E,get isLoading(){return o(S)},get isAuthenticated(){return o(m)}})}function Ee({authClient:e,convexUrl:n,convexClient:t,options:a,externalSession:s}){let r=b(null);const l=T(()=>o(r)??!1),i=T(()=>o(r)===null),{convexClient:u}=G(n,t,a),c=Le(e,s,p=>{a?.verbose&&console.debug(`${new Date().toISOString()} ${p}`)});H(()=>{let p=!0;return u.setAuth(g=>c(g),g=>{p&&h(r,g,!0)}),()=>{p=!1,h(r,o(r)?!1:null,!0)}}),I(K,{authClient:e,fetchAccessToken:c,get isLoading(){return o(i)},get isAuthenticated(){return o(l)}})}const Be=(e,n)=>async({forceRefreshToken:t})=>{if(!t)return null;const a=await Pe(e,n);return n("browser: returning retrieved token"),a},Le=(e,n,t)=>async()=>{const a=await n.getAccessToken();if(!a)return t("external: no access token"),null;try{const{data:s}=await e.convex.token(void 0,{headers:{Authorization:`Bearer ${a}`}});return s?.token??null}catch(s){if(!J(s))throw s;return t("external: network error when fetching Convex JWT"),null}},Oe=(e,n)=>{let t=null;try{t=V("$$_convexClient")}catch{}if(!t)try{z(e,n);try{t=V("$$_convexClient")}catch{console.warn("setupConvex completed but client not available in context")}}catch(a){console.warn("Failed to setup Convex client:",a)}if(!t)throw new Error("No ConvexClient was provided. Either pass one to createSvelteAuthClient or call setupConvex() first.");return t},Pe=async(e,n)=>{let s=0;const r=()=>{const i=100*Math.pow(2,s);s+=1;const u=Math.min(i,1e3),f=u*(Math.random()-.5);return u+f},l=async()=>{try{const{data:i}=await e.convex.token();return i?.token||null}catch(i){if(!J(i))throw i;if(s>10)throw n("fetchToken failed with network error, giving up"),i;const u=r();return n(`fetchToken failed with network error, attempting retrying in ${u}ms`),await new Promise(f=>setTimeout(f,u)),l()}};return l()},De=async e=>{const n=new URL(window.location?.href),t=n.searchParams.get("ott");if(t){const a=e;n.searchParams.delete("ott");const r=(await a.crossDomain.oneTimeToken.verify({token:t})).data?.session;r&&(await e.getSession({fetchOptions:{headers:{Authorization:`Bearer ${r.token}`}}}),a.updateSession()),window.history.replaceState({},"",n)}},R=Ae;new de(R);var Ne=P('<div class="app-header__rail"><nav class="app-header__nav" aria-label="Primary"><a class="app-header__link">Library</a> <a class="app-header__link">Practice</a> <a class="app-header__link">Settings</a></nav> <!></div>'),Me=P('<header class="app-header"><div class="page-shell page-shell--narrow !py-3 sm:!py-4"><div class="app-header__stack"><div class="app-header__top"><a class="app-header__brand"><span class="info-kicker">Daily Language Recall</span> <span class="app-header__title">Recall</span></a></div> <!></div></div></header>');function Re(e,n){X(n,!1);const t=()=>pe(we,"$isAuthenticated",a),[a,s]=ve();async function r(){await Y.signOut(),me(C("/login"))}function l(v){const m=C(v);return j.url.pathname===m||j.url.pathname.startsWith(`${m}/`)}ge();var i=Me(),u=y(i),f=y(u),c=y(f),p=y(c);A(c);var g=B(c,2);{var $=v=>{var m=Ne(),S=y(m),w=y(S),O=B(w,2),E=B(O,2);A(S);var d=B(S,2);_e(d,{variant:"outline",size:"sm",onclick:r,class:"app-header__action",children:(k,x)=>{le();var D=te("Logout");L(k,D)},$$slots:{default:!0}}),A(m),M((k,x,D,Q,Z,ee)=>{_(w,"href",k),_(w,"data-active",x),_(O,"href",D),_(O,"data-active",Q),_(E,"href",Z),_(E,"data-active",ee)},[()=>C("/"),()=>l("/"),()=>C("/practice"),()=>l("/practice"),()=>C("/settings"),()=>l("/settings")]),L(v,m)};he(g,v=>{t()&&v($)})}A(f),A(u),A(i),M(v=>_(p,"href",v),[()=>C("/")]),L(e,i),q(),s()}var Fe=P('<link rel="icon"/>'),We=P("<!> <!>",1);function Ze(e,n){X(n,!0),z(R),$e({authClient:Y,convexUrl:R});var t=We();xe("12qhfyh",r=>{var l=Fe();M(()=>_(l,"href",ye)),L(r,l)});var a=ue(t);Re(a,{});var s=B(a,2);fe(s,()=>n.children),L(e,t),q()}export{Ze as component};

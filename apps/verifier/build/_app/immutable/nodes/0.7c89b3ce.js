import{a as A,f as $,t as K}from"../chunks/8245242a.js";import{L as Q,h as Y,aV as Z,i as L,G as ee,a7 as M,a9 as V,Z as F,D as te,a5 as ae,l as W,b as h,g as o,aW as j,d as m,as as ne,aN as se,at as x,aX as U,p as H,t as O,a as I,c as _,r as k,s as D,n as re,f as oe}from"../chunks/892810b2.js";import{r as N,s as S,B as ie,a as X,d as ce}from"../chunks/ce1a43ed.js";import{s as q,C as le,c as ue}from"../chunks/1af8182f.js";import{i as de}from"../chunks/6df5f7eb.js";import{i as fe,a as he,s as ve}from"../chunks/0b1ed176.js";import{g as pe}from"../chunks/9aa20931.js";function ge(e,n){let t=null,a=L;var r;if(L){t=te;for(var s=ae(document.head);s!==null&&(s.nodeType!==ee||s.data!==e);)s=M(s);if(s===null)V(!1);else{var c=M(s);s.remove(),F(c)}}L||(r=document.head.appendChild(Q()));try{Y(()=>n(r),Z)}finally{a&&(V(!0),F(t))}}const we="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='107'%20height='128'%20viewBox='0%200%20107%20128'%3e%3ctitle%3esvelte-logo%3c/title%3e%3cpath%20d='M94.157%2022.819c-10.4-14.885-30.94-19.297-45.792-9.835L22.282%2029.608A29.92%2029.92%200%200%200%208.764%2049.65a31.5%2031.5%200%200%200%203.108%2020.231%2030%2030%200%200%200-4.477%2011.183%2031.9%2031.9%200%200%200%205.448%2024.116c10.402%2014.887%2030.942%2019.297%2045.791%209.835l26.083-16.624A29.92%2029.92%200%200%200%2098.235%2078.35a31.53%2031.53%200%200%200-3.105-20.232%2030%2030%200%200%200%204.474-11.182%2031.88%2031.88%200%200%200-5.447-24.116'%20style='fill:%23ff3e00'/%3e%3cpath%20d='M45.817%20106.582a20.72%2020.72%200%200%201-22.237-8.243%2019.17%2019.17%200%200%201-3.277-14.503%2018%2018%200%200%201%20.624-2.435l.49-1.498%201.337.981a33.6%2033.6%200%200%200%2010.203%205.098l.97.294-.09.968a5.85%205.85%200%200%200%201.052%203.878%206.24%206.24%200%200%200%206.695%202.485%205.8%205.8%200%200%200%201.603-.704L69.27%2076.28a5.43%205.43%200%200%200%202.45-3.631%205.8%205.8%200%200%200-.987-4.371%206.24%206.24%200%200%200-6.698-2.487%205.7%205.7%200%200%200-1.6.704l-9.953%206.345a19%2019%200%200%201-5.296%202.326%2020.72%2020.72%200%200%201-22.237-8.243%2019.17%2019.17%200%200%201-3.277-14.502%2017.99%2017.99%200%200%201%208.13-12.052l26.081-16.623a19%2019%200%200%201%205.3-2.329%2020.72%2020.72%200%200%201%2022.237%208.243%2019.17%2019.17%200%200%201%203.277%2014.503%2018%2018%200%200%201-.624%202.435l-.49%201.498-1.337-.98a33.6%2033.6%200%200%200-10.203-5.1l-.97-.294.09-.968a5.86%205.86%200%200%200-1.052-3.878%206.24%206.24%200%200%200-6.696-2.485%205.8%205.8%200%200%200-1.602.704L37.73%2051.72a5.42%205.42%200%200%200-2.449%203.63%205.79%205.79%200%200%200%20.986%204.372%206.24%206.24%200%200%200%206.698%202.486%205.8%205.8%200%200%200%201.602-.704l9.952-6.342a19%2019%200%200%201%205.295-2.328%2020.72%2020.72%200%200%201%2022.237%208.242%2019.17%2019.17%200%200%201%203.277%2014.503%2018%2018%200%200%201-8.13%2012.053l-26.081%2016.622a19%2019%200%200%201-5.3%202.328'%20style='fill:%23fff'/%3e%3c/svg%3e",_e="https://disciplined-spider-126.convex.cloud",ke=Object.prototype.toString,me=e=>ke.call(e)==="[object Error]",xe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function z(e){if(!(e&&me(e)&&e.name==="TypeError"&&typeof e.message=="string"))return!1;const{message:t,stack:a}=e;return t==="Load failed"?a===void 0||"__sentry_captured__"in e:t.startsWith("error sending request for url")?!0:xe.has(t)}const G=Symbol("auth-context");function ye({authClient:e,convexUrl:n,convexClient:t,options:a,externalSession:r,getServerState:s}){return r?Ce({authClient:e,convexUrl:n,convexClient:t,options:a,externalSession:r}):Ae({authClient:e,convexUrl:n,convexClient:t,options:a,getServerState:s})}const J=(e,n,t)=>{const a=e;let r=n;return r||(r=Se(a,{disabled:!1,...t})),{url:a,convexClient:r}};function Ae({authClient:e,convexUrl:n,convexClient:t,options:a,getServerState:r}){const s=r?.(),c=s!==void 0,i=s?.isAuthenticated===!0;let l=m(null),d=m(!0),u=m(ne(i?!0:null)),v=m(!1),g=m(!1);e.useSession().subscribe(f=>{h(v,!0);const R=o(l)!==null;h(l,f.data,!0),h(d,f.isPending,!0),f.isPending||h(g,!0);const B=o(l)!==null;R&&!B&&h(u,!1),f.isPending&&o(u)!==null&&o(g)&&h(u,null)});const p=x(()=>o(l)!==null),w=x(()=>o(v)&&!o(d)),y=x(()=>o(w)?o(p)&&(o(u)??!1):i),C=x(()=>o(w)?o(d)||o(p)&&o(u)===null:!c),{convexClient:b}=J(n,t,a),E=be(e,f=>{a?.verbose&&console.debug(`${new Date().toISOString()} ${f}`)});se(()=>{Ee(e)}),W(()=>{let f=!0;return i||o(p)?(b.setAuth(E,B=>{f&&h(u,B,!0)}),()=>{f=!1,h(u,o(u)?!1:null,!0)}):(b.client.clearAuth(),()=>{h(u,null)})}),j(G,{authClient:e,fetchAccessToken:E,get isLoading(){return o(C)},get isAuthenticated(){return o(y)}})}function Ce({authClient:e,convexUrl:n,convexClient:t,options:a,externalSession:r}){let s=m(null);const c=x(()=>o(s)??!1),i=x(()=>o(s)===null),{convexClient:l}=J(n,t,a),u=Te(e,r,v=>{a?.verbose&&console.debug(`${new Date().toISOString()} ${v}`)});W(()=>{let v=!0;return l.setAuth(g=>u(g),g=>{v&&h(s,g,!0)}),()=>{v=!1,h(s,o(s)?!1:null,!0)}}),j(G,{authClient:e,fetchAccessToken:u,get isLoading(){return o(i)},get isAuthenticated(){return o(c)}})}const be=(e,n)=>async({forceRefreshToken:t})=>{if(!t)return null;const a=await $e(e,n);return n("browser: returning retrieved token"),a},Te=(e,n,t)=>async()=>{const a=await n.getAccessToken();if(!a)return t("external: no access token"),null;try{const{data:r}=await e.convex.token(void 0,{headers:{Authorization:`Bearer ${a}`}});return r?.token??null}catch(r){if(!z(r))throw r;return t("external: network error when fetching Convex JWT"),null}},Se=(e,n)=>{let t=null;try{t=U("$$_convexClient")}catch{}if(!t)try{q(e,n);try{t=U("$$_convexClient")}catch{console.warn("setupConvex completed but client not available in context")}}catch(a){console.warn("Failed to setup Convex client:",a)}if(!t)throw new Error("No ConvexClient was provided. Either pass one to createSvelteAuthClient or call setupConvex() first.");return t},$e=async(e,n)=>{let r=0;const s=()=>{const i=100*Math.pow(2,r);r+=1;const l=Math.min(i,1e3),d=l*(Math.random()-.5);return l+d},c=async()=>{try{const{data:i}=await e.convex.token();return i?.token||null}catch(i){if(!z(i))throw i;if(r>10)throw n("fetchToken failed with network error, giving up"),i;const l=s();return n(`fetchToken failed with network error, attempting retrying in ${l}ms`),await new Promise(d=>setTimeout(d,l)),c()}};return c()},Ee=async e=>{const n=new URL(window.location?.href),t=n.searchParams.get("ott");if(t){const a=e;n.searchParams.delete("ott");const s=(await a.crossDomain.oneTimeToken.verify({token:t})).data?.session;s&&(await e.getSession({fetchOptions:{headers:{Authorization:`Bearer ${s.token}`}}}),a.updateSession()),window.history.replaceState({},"",n)}},P=_e;new le(P);var Be=$('<div class="app-header__rail"><nav class="app-header__nav" aria-label="Primary"><a class="app-header__link">Queue</a></nav> <!></div>'),Le=$('<header class="app-header"><div class="page-shell page-shell--narrow !py-3 sm:!py-4"><div class="app-header__stack"><div class="app-header__top"><a class="app-header__brand"><span class="info-kicker">Rapid Review Desk</span> <span class="app-header__title">Recall Verifier</span></a></div> <!></div></div></header>');function Ne(e,n){H(n,!1);const t=()=>ve(ue,"$isAuthenticated",a),[a,r]=he();async function s(){await X.signOut(),pe(N("/login"))}de();var c=Le(),i=_(c),l=_(i),d=_(l),u=_(d);k(d);var v=D(d,2);{var g=p=>{var w=Be(),y=_(w),C=_(y);S(C,"data-active",!0),k(y);var b=D(y,2);ie(b,{variant:"outline",size:"sm",onclick:s,class:"app-header__action",children:(T,E)=>{re();var f=K("Logout");A(T,f)},$$slots:{default:!0}}),k(w),O(T=>S(C,"href",T),[()=>N("/")]),A(p,w)};fe(v,p=>{t()&&p(g)})}k(l),k(i),k(c),O(p=>S(u,"href",p),[()=>N("/")]),A(e,c),I(),r()}var Oe=$('<link rel="icon"/>'),De=$("<!> <!>",1);function je(e,n){H(n,!0),q(P),ye({authClient:X,convexUrl:P});var t=De();ge("12qhfyh",s=>{var c=Oe();O(()=>S(c,"href",we)),A(s,c)});var a=oe(t);Ne(a,{});var r=D(a,2);ce(r,()=>n.children),A(e,t),I()}export{je as component};
